{% extends 'base.html' %}
{% load user_status %}

{% block content %}

<style type="text/css">

.module-info-popover, .section-info-popover{
	cursor: pointer;
}
</style>

<h1>Dashboard</h1>
{% for module in root.get_children %}
<div class="row-fluid">
	<div class="span5">
		<a class="section_url" href="{{module.get_absolute_url}}">{{module.label}}</a>
	</div>
	<div class="span1">
		{% get_user_section_status request.user module as status %}
		{% ifequal status.status "complete" %}
		<img src="/site_media/img/status_completed.png">
		{% endifequal %}
		{% ifequal status.status "incomplete" %}
		<img src="/site_media/img/status_inprogress.png">
		{% endifequal %}
		{% if not status %}
		<img class="uninitiated" src="/site_media/img/status_uninitiated.png">
		{% endif %}

	</div>
	{% for info in dashboard_info %}
		{% ifequal module.id info.dashboard_id %}
			<div data-content="{{ info.info }}" data-original-title="Module Info" class="module-info-popover span1"><img src="/site_media/img/status_info.png"></div>
		{% endifequal %}
	{% endfor %}
</div>

	{% for section in module.get_children %}

	<div class="row-fluid">
		<div class="span1"></div>
		<div class="span4">
				<a class="section_url" href="{{section.get_absolute_url}}">{{section.label}}</a>
		</div>
		<div class="span1">
			{% get_user_section_status request.user section as status %}
			{% ifequal status.status "complete" %}
			<img src="/site_media/img/status_completed.png">
			{% endifequal %}
			{% ifequal status.status "incomplete" %}
			<img src="/site_media/img/status_inprogress.png">
			{% endifequal %}
			{% if not status %}
			<img class="uninitiated" src="/site_media/img/status_uninitiated.png">
			{% endif %}
		</div>

		{% for info in dashboard_info %}
			{% ifequal section.id info.dashboard_id %}
				{% ifnotequal info.info empty %}
					<div data-content="{{ info.info }}" data-original-title="Section Info" class="section-info-popover span1"><img src="/site_media/img/status_info.png"></div>
				{% endifnotequal%}
			{% endifequal %}
		{% endfor %}
	</div>
		{% if section.get_children %}
			<div class="row-fluid">
				{%for c in section.get_children %}
				<div class ="span5" style="margin:0 0 0 100px; width:276px;">
					<a class="section_url" href="{{ c.get_absolute_url }}"> {{ c.label }}</a>
				</div>
					<div class="span1">
						{% get_user_section_status request.user c as status %}
						{% ifequal status.status "complete" %}
						<img src="/site_media/img/status_completed.png">
						{% endifequal %}
						{% ifequal status.status "incomplete" %}
						<img src="/site_media/img/status_inprogress.png">
						{% endifequal %}
						{% if not status %}
						<img class="uninitiated" src="/site_media/img/status_uninitiated.png">
						{% endif %}
					</div>
					{% for info in dashboard_info %}
						{% ifequal c.id info.dashboard_id %}
							{% ifnotequal info.info empty%}
							<div data-content="{{ info.info }}" data-original-title="Section Info" class="section-info-popover span1"><img src="/site_media/img/status_info.png"></div>
							{% endifnotequal %}
						{% endifequal %}
					{% endfor %}

					{% if c.get_children %}
					<div class="row-fluid">
						{%for d in c.get_children %}
							<div class ="span5" style="margin:0 0 0 150px; width:226px;">
								<a class="section_url" href="{{ d.get_absolute_url }}"> {{ d.label }}</a>
							</div>
							<div class="span1" style="margin:0 0 0 75px;">
								{% get_user_section_status request.user d as status %}
								{% ifequal status.status "complete" %}
								<img src="/site_media/img/status_completed.png">
								{% endifequal %}
								{% ifequal status.status "incomplete" %}
								<img src="/site_media/img/status_inprogress.png">
								{% endifequal %}
								{% if not status %}
								<img class="uninitiated" src="/site_media/img/status_uninitiated.png">
								{% endif %}
							</div>
							{% for info in dashboard_info %}
								{% ifequal d.id info.dashboard_id %}
									{% ifnotequal info.info empty %}
										<div data-content="{{ info.info }}" data-original-title="Section Info" class="section-info-popover span1"><img src="/site_media/img/status_info.png"></div>
									{% endifnotequal%}
								{% endifequal %}
							{% endfor %}
						{% endfor %}
					</div>
					{% endif %}

				{% endfor %}
			</div>
		{% endif %}
	{% endfor %}

{% endfor %}
<script>
jQuery(document).ready(function($){
	$(".module-info-popover").popover({
    	offset: 10,
    	trigger:'manual'

    }).click(function(){
         $(this).popover('show')

    }).mouseleave(function(){
    	$(this).popover('hide')
    });

	$(".section-info-popover").popover({
    	offset: 10,
    	trigger:'manual'

    }).click(function(){
         $(this).popover('show')

    }).mouseleave(function(){
    	$(this).popover('hide')
    });

	/*
	* undo all anchor tags  that are unititiated 
	*/

	var links = jQuery('.section_url');
	var uninitiated = []

	links.each(function(){
		var link = jQuery(this);
		var class_name = link.parent().next().children().attr('class')
		if(class_name == "uninitiated" ){
			uninitiated.push(link)
		}else{
			console.log('nope')
		}
	})

	jQuery(uninitiated).each(function(i){
		if(i === 0){
		}
		else{
			var link = jQuery(this);
			var linkSpan = '<span>'+ link.html() +'</span>'
			link.parent().append(linkSpan)
			link.remove()
		}
	}) 
});
</script>

{% endblock %}
